---

# app present

- name: macOS app defaults are present
  with_items: "{{ macos_apps }}"
  when: item.state == "present" and item.defaults
  copy:
    src: "{{ item.defaults }}"
    dest: ~/Library/Preferences/

- name: macOS app is present
  with_items: "{{ macos_apps }}"
  when: item.state == "present"
  macos_app:
    name: "{{ item.name }}"
    state: present

# app absent

- name: macOS app is absent
  with_items: "{{ macos_apps }}"
  when: item.state == "absent"
  macos_app:
    name: "{{ item.name }}"
    state: absent

- name: macOS app defaults are absent
  with_subelements:
  - "{{ macos_apps }}"
  - domains
  when: item.0.state == "absent"
  macos_defaults:
    domain: "{{ item.1 }}"
    state: absent

- name: macOS app extra preferences are absent
  with_subelements:
  - "{{ macos_apps }}"
  - domains
  when: item.0.state == "absent"
  file:
    path: ~/Library/Preferences/{{ item.1 }}
    state: absent

- name: macOS app support is absent
  with_items: "{{ macos_apps }}"
  when: item.state == "absent"
  file:
    path: ~/Library/MacOS app Support/{{ item.name }}
    state: absent

- name: macOS app container is absent
  with_subelements:
  - "{{ macos_apps }}"
  - domains
  when: item.0.state == "absent"
  file:
    path: ~/Library/Containers/{{ item.1 }}
    state: absent

- name: macOS app package is absent
  with_subelements:
  - "{{ macos_apps }}"
  - domains
  when: item.0.state == "absent"
  macos_pkg:
    name: "{{ item.1 }}"
    state: absent
